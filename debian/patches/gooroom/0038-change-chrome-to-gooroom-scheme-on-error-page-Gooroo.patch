From 26654a68833b66e8452815371af85db0861a8365 Mon Sep 17 00:00:00 2001
From: junsungc <junsungc@gooroom.kr>
Date: Mon, 27 Jul 2020 11:59:22 +0900
Subject: [PATCH 38/63] change chrome to gooroom scheme on error page [Gooroom
 Bug Tracking System - 0000400] change chrome to gooroom scheme on
 content-settings bubble model

---
 .../content_settings/content_setting_bubble_model.cc   | 10 ++++++++++
 components/error_page/common/localized_error.cc        | 10 ++++++++++
 2 files changed, 20 insertions(+)

diff --git a/chrome/browser/ui/content_settings/content_setting_bubble_model.cc b/chrome/browser/ui/content_settings/content_setting_bubble_model.cc
index 51575c2123ac0..f0a2adb0439a7 100644
--- a/chrome/browser/ui/content_settings/content_setting_bubble_model.cc
+++ b/chrome/browser/ui/content_settings/content_setting_bubble_model.cc
@@ -91,6 +91,8 @@
 #include "services/device/public/cpp/geolocation/geolocation_manager.h"
 #endif
 
+#include "gooroom/URLRewrite/gooroom_url_rewrite.h"
+
 using base::UserMetricsAction;
 using content::WebContents;
 using content_settings::PageSpecificContentSettings;
@@ -960,7 +962,15 @@ void ContentSettingMediaStreamBubbleModel::SetRadioGroup() {
   RadioGroup radio_group;
   radio_group.url = url;
 
+#if defined(GOOROOM_BUILD)
+// change chrome:// to gooroom:// on content-setting-bubble-popup.
+  GURL changed_url = GooroomURLRewrite::ChangeGooroomScheme(url);
+  std::u16string display_host = url_formatter::FormatUrlForSecurityDisplay(changed_url);
+  if (display_host.empty())
+    display_host = base::ASCIIToUTF16(changed_url.spec());
+#else
   std::u16string display_host = url_formatter::FormatUrlForSecurityDisplay(url);
+#endif
 
   DCHECK(CameraAccessed() || MicrophoneAccessed());
   int radio_allow_label_id = 0;
diff --git a/components/error_page/common/localized_error.cc b/components/error_page/common/localized_error.cc
index b0f30f4903ea7..b205468449ea5 100644
--- a/components/error_page/common/localized_error.cc
+++ b/components/error_page/common/localized_error.cc
@@ -41,6 +41,8 @@
 #include "base/win/windows_version.h"
 #endif
 
+#include "gooroom/URLRewrite/gooroom_url_rewrite.h"
+
 namespace error_page {
 
 namespace {
@@ -974,9 +976,17 @@ LocalizedError::PageState LocalizedError::GetPageState(
     options.suggestions &= ~SUGGEST_LEARNMORE;
   }
 
+#if defined(GOOROOM_BUILD)
+//Change chrome:// to gooroom:// on error pages
+  GURL changed_failed_url = GooroomURLRewrite::ChangeGooroomScheme(failed_url);
+  std::u16string failed_url_string(url_formatter::FormatUrl(
+      changed_failed_url, url_formatter::kFormatUrlOmitNothing,
+      net::UnescapeRule::NORMAL, nullptr, nullptr, nullptr));
+#else
   std::u16string failed_url_string(url_formatter::FormatUrl(
       failed_url, url_formatter::kFormatUrlOmitNothing,
       net::UnescapeRule::NORMAL, nullptr, nullptr, nullptr));
+#endif
   // URLs are always LTR.
   if (base::i18n::IsRTL())
     base::i18n::WrapStringWithLTRFormatting(&failed_url_string);
-- 
2.30.2

