From af9491ca22908e86c1c62d8914b4496d32b49d84 Mon Sep 17 00:00:00 2001
From: Tom Sepez <tsepez@chromium.org>
Date: Tue, 9 Jun 2020 22:32:04 +0000
Subject: [PATCH] Merge to M84: Make PDFium JS host object have immutable
 prototypes

It is doubtful that any legitimate PDF would ever change __proto__
on these objects, and those that do are just trying to muck with us.

TBR: thestig@chromium.org
Bug: chromium:1091404
Change-Id: I99367281e796b91c1858fead3eb18a3a655291f1
Reviewed-on: https://pdfium-review.googlesource.com/c/pdfium/+/70430
Commit-Queue: Tom Sepez <tsepez@chromium.org>
Reviewed-by: Lei Zhang <thestig@chromium.org>
(cherry picked from commit 9b9ba210f32c2a33cff3502a75eb84c39ad5576a)
Reviewed-on: https://pdfium-review.googlesource.com/c/pdfium/+/70471
Reviewed-by: Tom Sepez <tsepez@chromium.org>
---
 third_party/pdfium/fxjs/cfxjs_engine.cpp | 1 +
 1 file changed, 1 insertion(+)

diff --git a/third_party/pdfium/fxjs/cfxjs_engine.cpp b/third_party/pdfium/fxjs/cfxjs_engine.cpp
index 9624feb2d..4a15ebe11 100644
--- a/third_party/pdfium/fxjs/cfxjs_engine.cpp
+++ b/third_party/pdfium/fxjs/cfxjs_engine.cpp
@@ -145,6 +145,7 @@ class CFXJS_ObjDefinition {
     v8::HandleScope handle_scope(isolate);
     v8::Local<v8::FunctionTemplate> fn = v8::FunctionTemplate::New(isolate);
     fn->InstanceTemplate()->SetInternalFieldCount(2);
+    fn->InstanceTemplate()->SetImmutableProto();
     fn->SetCallHandler(CallHandler, v8::Number::New(isolate, eObjType));
     if (eObjType == FXJSOBJTYPE_GLOBAL) {
       fn->InstanceTemplate()->Set(v8::Symbol::GetToStringTag(isolate),
-- 
2.20.1

