From 392f6c0aa9001c332e34eb8c94c99785478b1fc8 Mon Sep 17 00:00:00 2001
From: junsungc <junsungc@gooroom.kr>
Date: Wed, 20 Apr 2022 11:39:49 +0900
Subject: [PATCH] BugFix - 5204, 5203, 5202, 5199

---
 chrome/app/resources/generated_resources_ko.xtb              | 4 +++-
 .../browser/ui/webui/print_preview/print_preview_handler.cc  | 5 ++++-
 third_party/blink/renderer/core/workers/dedicated_worker.cc  | 2 +-
 .../blink/renderer/modules/websockets/dom_websocket.cc       | 2 +-
 4 files changed, 9 insertions(+), 4 deletions(-)

diff --git a/chrome/app/resources/generated_resources_ko.xtb b/chrome/app/resources/generated_resources_ko.xtb
index 9f712be57..25ce9d11e 100644
--- a/chrome/app/resources/generated_resources_ko.xtb
+++ b/chrome/app/resources/generated_resources_ko.xtb
@@ -1,6 +1,8 @@
 <?xml version="1.0" ?>
 <!DOCTYPE translationbundle>
 <translationbundle lang="ko">
+<translation id="2273707414284427980">웹 소켓 사용 설정</translation>
+<translation id="4851515493665413363">웹 워커 사용 설정</translation>
 <translation id="1001033507375626788">나와 공유된 네트워크입니다.</translation>
 <translation id="1001307489511021749">앱, 설정 및 기타 맞춤설정이 내 Google 계정으로 로그인된 모든 Gooroom Browser OS 기기에서 동기화됩니다.</translation>
 <translation id="1003088604756913841">새 <ph name="APP" /> 창에서 링크 열기</translation>
@@ -8082,4 +8084,4 @@
 <translation id="996250603853062861">안전한 연결 설정 중...</translation>
 <translation id="99731366405731005">Wi-Fi 동기화를 사용하려면 <ph name="LINK1_BEGIN" />Gooroom Browser 동기화<ph name="LINK1_END" />를 사용 설정하세요. <ph name="LINK2_BEGIN" />자세히 알아보기<ph name="LINK2_END" /></translation>
 <translation id="998747458861718449">검사(&amp;N)</translation>
-</translationbundle>
\ No newline at end of file
+</translationbundle>
diff --git a/chrome/browser/ui/webui/print_preview/print_preview_handler.cc b/chrome/browser/ui/webui/print_preview/print_preview_handler.cc
index 029a4ee13..06d0e2717 100644
--- a/chrome/browser/ui/webui/print_preview/print_preview_handler.cc
+++ b/chrome/browser/ui/webui/print_preview/print_preview_handler.cc
@@ -12,6 +12,7 @@
 #include <utility>
 #include <vector>
 
+#include "gooroom/URLRewrite/gooroom_url_rewrite.h"
 #include "base/base64.h"
 #include "base/bind.h"
 #include "base/callback_helpers.h"
@@ -745,9 +746,11 @@ void PrintPreviewHandler::HandleGetPreview(const base::ListValue* args) {
     url_sanitizer.ClearUsername();
     url_sanitizer.ClearPassword();
     const GURL& initiator_url = initiator->GetLastCommittedURL();
+    GURL changed_url = GooroomURLRewrite::ChangeGooroomScheme(initiator_url);
+
     settings.SetKey(kSettingHeaderFooterURL,
                     base::Value(url_formatter::FormatUrl(
-                        initiator_url.ReplaceComponents(url_sanitizer))));
+                        changed_url.ReplaceComponents(url_sanitizer))));
   }
 
   VLOG(1) << "Print preview request start";
diff --git a/third_party/blink/renderer/core/workers/dedicated_worker.cc b/third_party/blink/renderer/core/workers/dedicated_worker.cc
index f141b4dab..1cdd9ce4f 100644
--- a/third_party/blink/renderer/core/workers/dedicated_worker.cc
+++ b/third_party/blink/renderer/core/workers/dedicated_worker.cc
@@ -88,7 +88,7 @@ DedicatedWorker* DedicatedWorker::Create(ExecutionContext* context,
 
     Page* page = frm->GetPage();
     // FIXME : care character encoding
-    page->GetChromeClient().OpenJavaScriptConfirm(frm, WTF::String::FromUTF8("梨 몃 곌껐 媛 李⑤⑤듬 뱀而ㅼ 명댁＜몄."));
+    page->GetChromeClient().OpenJavaScriptConfirm(frm, WTF::String::FromUTF8("정책에 의해 외부 연결 시도가 차단되었습니다. 웹워커 설정을 확인해주세요."));
 
     return nullptr;
   }
diff --git a/third_party/blink/renderer/modules/websockets/dom_websocket.cc b/third_party/blink/renderer/modules/websockets/dom_websocket.cc
index 51c42bb14..de9f2733f 100644
--- a/third_party/blink/renderer/modules/websockets/dom_websocket.cc
+++ b/third_party/blink/renderer/modules/websockets/dom_websocket.cc
@@ -286,7 +286,7 @@ void DOMWebSocket::Connect(const String& url,
     LocalFrame* frm = DynamicTo<LocalDOMWindow>(GetExecutionContext())->GetFrame();
     Page* page = frm->GetPage();
     // FIXME : care character encoding
-    page->GetChromeClient().OpenJavaScriptConfirm(frm, WTF::String::FromUTF8("梨 몃 곌껐 媛 李⑤⑤듬 뱀耳 ㅼ 명댁＜몄."));
+    page->GetChromeClient().OpenJavaScriptConfirm(frm, WTF::String::FromUTF8("정책에 의해 외부 연결 시도가 차단되었습니다. 웹소켓 설정을 확인해주세요."));
 
     //page->GetChromeClient().OpenJavaScriptAlert(
     //    frm, "External connection attempts were blocked by policy.");
-- 
2.30.2

